<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ball Click Game</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; margin-top: 50px; }
        canvas { border: 1px solid black; margin: 20px auto; display: block; }
        #timer { font-size: 24px; margin-bottom: 20px; }
    </style>
</head>
<body>
    <h1>Click the Balls!</h1>
    <div id="timer">Time Left: 5</div>
    <canvas id="gameCanvas" width="800" height="600"></canvas>

    <script src="https://cdn.socket.io/4.0.1/socket.io.min.js"></script>
    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const timerDisplay = document.getElementById('timer');

        let balls = [];
        let remainingTime = 5;
        let gameStarted = false;
        const socket = io('http://localhost:3000');  // Connect to the server

        // Listen for ball updates from the server
        socket.on('newBall', (x, y) => {
            balls.push({ x, y, radius: 20 });
            drawBalls();
        });

        // Listen for the ball removal event from the server
        socket.on('removeBall', (x, y) => {
            balls = balls.filter(ball => ball.x !== x || ball.y !== y);
            drawBalls();
        });

        // Listen for the timer update from the server
        socket.on('updateTime', (time) => {
            remainingTime = time;
            timerDisplay.textContent = `Time Left: ${remainingTime}`;
            if (remainingTime <= 0) {
                gameStarted = false;
                alert('Game Over!');
            }
        });

        // Draw all balls on the canvas
        function drawBalls() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            balls.forEach(ball => {
                ctx.beginPath();
                ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2);
                ctx.fillStyle = 'red';
                ctx.fill();
                ctx.closePath();
            });
        }

        // Handle mouse clicks to remove balls
        canvas.addEventListener('click', (e) => {
            if (!gameStarted) return;

            const mouseX = e.offsetX;
            const mouseY = e.offsetY;

            balls.forEach(ball => {
                const dist = Math.sqrt((mouseX - ball.x) ** 2 + (mouseY - ball.y) ** 2);
                if (dist <= ball.radius) {
                    socket.emit('ballClicked', ball.x, ball.y);  // Send the click event to the server
                }
            });
        });

        // Start the game
        function startGame() {
            gameStarted = true;
            socket.emit('startGame');  // Notify the server to start the game

            // Initial timer countdown
            setInterval(() => {
                if (gameStarted && remainingTime > 0) {
                    remainingTime--;
                    socket.emit('updateTime', remainingTime);  // Send timer update to server
                }
            }, 1000);
        }

        // Start the game automatically after page load
        window.onload = () => {
            startGame();
        };

        // Listen for when the game is ready to start and balls are generated
        socket.on('gameStarted', () => {
            startGame();
        });
    </script>
</body>
</html>
const express = require('express');
const http = require('http');
const socketIo = require('socket.io');

const app = express();
const server = http.createServer(app);
const io = socketIo(server);

let balls = [];
let remainingTime = 5;
let gameStarted = false;

// Create 10 balls at random positions
function generateBalls() {
    balls = [];
    for (let i = 0; i < 10; i++) {
        let x = Math.random() * 750 + 50; // Random x position
        let y = Math.random() * 550 + 50; // Random y position
        balls.push({ x, y, radius: 20 });
    }
}

// Broadcast the state to all connected clients
function broadcastState() {
    io.emit('newBall', balls);
    io.emit('updateTime', remainingTime);
}

io.on('connection', (socket) => {
    console.log('A user connected');

    // When the game starts
    if (gameStarted) {
        socket.emit('gameStarted');
        broadcastState();
    }

    // Start the game when a client requests it
    socket.on('startGame', () => {
        if (!gameStarted) {
            gameStarted = true;
            generateBalls();
            broadcastState();
            startTimer();
        }
    });

    // Handle ball click (a ball was clicked by a player)
    socket.on('ballClicked', (x, y) => {
        balls = balls.filter(ball => !(ball.x === x && ball.y === y)); // Remove the clicked ball
        io.emit('removeBall', x, y);  // Broadcast to all clients
    });

    // Update the timer and broadcast it to all clients
    socket.on('updateTime', (time) => {
        remainingTime = time;
        if (remainingTime <= 0) {
            gameStarted = false;
            io.emit('gameOver');
        }
    });

    socket.on('disconnect', () => {
        console.log('A user disconnected');
    });
});

// Start the timer countdown
function startTimer() {
    setInterval(() => {
        if (gameStarted && remainingTime > 0) {
            remainingTime--;
            io.emit('updateTime', remainingTime);  // Broadcast to all clients
        }
        if (remainingTime <= 0) {
            gameStarted = false;
            io.emit('gameOver');  // Notify all clients the game is over
        }
    }, 1000);
}

server.listen(3000, () => {
    console.log('Server running on http://localhost:3000');
});
